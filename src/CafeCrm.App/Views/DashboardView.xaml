<UserControl x:Class="CafeCrm.App.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Margin="20" Background="#F5F5F5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Ð£Ñ‡ÐµÑ‚ Ð³Ð¾ÑÑ‚ÐµÐ¹"
                       FontSize="30"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,12" />

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource TouchTextBox}" />

                <Button Grid.Column="1"
                        Content="ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ"
                        Style="{StaticResource TouchButton}"
                        Command="{Binding ClearSearchCommand}" />

                <Button Grid.Column="2"
                        Content="ÐÐ¾Ð²Ñ‹Ð¹ Ð³Ð¾ÑÑ‚ÑŒ"
                        Style="{StaticResource TouchButton}"
                        Command="{Binding AddCustomerCommand}"
                        Margin="10,0,0,0" />
            </Grid>
        </StackPanel>

        <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0">
            <TabItem Header="ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding FilteredCustomers}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="3" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Style="{StaticResource TouchButton}"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        Command="{Binding DataContext.SelectCustomerCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        Background="{Binding Tier, Converter={StaticResource LoyaltyTierToBrushConverter}}">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="Bold"
                                                   FontSize="18"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap" />
                                        <TextBlock Text="{Binding Phone}"
                                                   FontSize="14"
                                                   Margin="0,6,0,0"
                                                   Opacity="0.8"
                                                   TextAlignment="Center" />
                                        <TextBlock Text="{Binding LoyaltyBalance, StringFormat='Ð‘Ð°Ð»Ð»Ñ‹: {0:F0}'}"
                                                   FontSize="14"
                                                   Margin="0,4,0,0"
                                                   Opacity="0.8"
                                                   TextAlignment="Center" />
                                        <TextBlock Text="{Binding LastVisitAt, StringFormat='ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð²Ð¸Ð·Ð¸Ñ‚: {0:dd MMM HH:mm}'}"
                                                   FontSize="12"
                                                   Margin="0,4,0,0"
                                                   TextAlignment="Center"
                                                   Opacity="0.8" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>`r`n`r`n            <TabItem Header="ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÑ‚Ð¾Ð»Ñ‹">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
                                Style="{StaticResource TouchButton}"
                                Command="{Binding RefreshActiveTablesCommand}"
                                IsEnabled="{Binding IsRefreshing, Converter={StaticResource InverseBooleanConverter}}" />

                        <ProgressBar Width="120"
                                     Height="12"
                                     Margin="12,0,0,0"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsRefreshing, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding ActiveTables}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="4" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource TouchButton}"
                                            Background="{Binding HasPosCheck, Converter={StaticResource BoolToTableColorConverter}}"
                                            Command="{Binding DataContext.SelectTableCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding TableNumber}"
                                                       FontSize="18"
                                                       FontWeight="Bold"
                                                       TextAlignment="Center" />
                                            <TextBlock Text="{Binding CustomerName}"
                                                       FontSize="14"
                                                       TextAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       Margin="0,4,0,0" />
                                            <TextBlock Text="{Binding CurrentAmount, StringFormat='Ð¡ÑƒÐ¼Ð¼Ð°: {0:C}'}"
                                                       FontSize="12"
                                                       TextAlignment="Center" />
                                            <TextBlock Text="{Binding DurationDisplay, StringFormat='Ð’Ñ€ÐµÐ¼Ñ: {0}'}"
                                                       FontSize="12"
                                                       TextAlignment="Center"
                                                       Opacity="0.8" />
                                            <TextBlock Text="{Binding ItemCount, StringFormat='ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¹: {0}'}"
                                                       FontSize="12"
                                                       TextAlignment="Center"
                                                       Opacity="0.8" />
                                            <TextBlock Text="{Binding HasPosCheck, Converter={StaticResource BoolToCheckStatusConverter}}"
                                                       FontSize="12"
                                                       TextAlignment="Center"
                                                       Margin="0,4,0,0" />
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </TabItem>`r`n`r`n            <TabItem Header="Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
                                Style="{StaticResource TouchButton}"
                                Command="{Binding LoadRecentEventsCommand}"
                                IsEnabled="{Binding IsLoadingEvents, Converter={StaticResource InverseBooleanConverter}}" />

                        <ProgressBar Width="120"
                                     Height="12"
                                     Margin="12,0,0,0"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsLoadingEvents, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding RecentEvents}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding EventType, Converter={StaticResource EventTypeToColorConverter}}"
                                            CornerRadius="5"
                                            Padding="12"
                                            Margin="0,4">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Message}"
                                                       FontSize="14"
                                                       TextWrapping="Wrap"
                                                       Foreground="White" />
                                            <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}'}"
                                                       FontSize="12"
                                                       Opacity="0.8"
                                                       Foreground="White"
                                                       Margin="0,4,0,0" />
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </TabItem>        </TabControl>
    </Grid>
</UserControl>
